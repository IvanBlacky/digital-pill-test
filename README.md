# Тестовое задание для Digital Pill

## Описание алгоритма определения генератора сообщений

Обычно для решения проблемы гонки при использовании несколькими приложениями одного ресурса используют алгоритмы класса Distributed Locks.
Наиболее распространенной практикой для Redis является алгоритм этого класса "Redlock", который и был использован для решения задачи.

Корректирующая константа нужна для того, чтобы смена генераторов не происходила слишком часто.
Так, если текущий генератор находится в рабочем состоянии, то у него будет преимущество
перед остальными приложениями в возобновлении своего статуса генератора по истечении TTL.
Однако если приложение-генератор было завершено, то система выберет нового генератора лишь с небольшой задержкой.
В случае, если в рамках использования приложения такой специфики не требуется, то корректирующая константа всегда может быть установлена в значение 0.

## Описание архитектуры приложения

### Абстрактные классы

#### AbstractService

Абстрактный класс сервиса. Реализует структуру сервиса и его базовые возможности: старт, стоп, работа с событийной моделью и проверка на статус (запущен или остановлен)

### Классы для Pub/Sub модели

#### PubSub

Класс, отвечающий за отслеживания состояния приложения (подписчик или публикатор),
основываясь на состоянии блокировки ресурса классом-блокиратором,
и делегирующий в зависимости от этого состояния исполнение роли другим классам.

#### PublisherService

Класс, отвечающий за публикацию сообщений в очереди сообщений.
Используется как класс-публикатор в классе `PubSub`.
Генерацию сообщений делегирует классу-генератору.

#### SubscriberService

Класс, отвечающий за чтение сообщений из очереди сообщений.
Используется как класс-подписчик в классе `PubSub`.
Обработку полученных сообщений делегирует классам-процессорам, которых может быть неограниченное кол-во

#### MessageProcessor

Класс, отвечающий за обработку сообщений.
Используется как класс-процессор в классе `SubscriberService`.
5% полученных сообщений принимает за ошибочное и складирует в специальный список в Redis.
Остальные сообщения игнорируются.

#### MessageGenerator

Класс, отвечающий за генерацию сообщений.
Используется как класс-генератор в классе `PublisherService`.

#### ResourceLocker

Класс, реализующий блокировку указанного ресурса и сообщающий о статусе этой блокировки.
Основан на алгоритме Redlock.

### Классы для обработки ошибок

#### Cleaner

Класс, отвечающий за обработку ошибочных сообщений.
Одно за одним берет сообщения из списка ошибочных сообщений, выводит на экран и удаляет.

### Класс App

Класс, связывающий нужные классы и управляющий общей логикой приложения.
Может работать в двух режимах: Pub/Sub и Cleaner

### Иные файлы

#### common/redis.js
Модуль, экспортирующий функцию-инициализатор клиента Redis.

#### data/config.json
Файл конфигурации приложения

#### index.js
Файл старта приложения. Определяет требуемый режим `App` и запускает его в этом режиме.

#### docker-compose.yml
Compose-файл с конфигурацией для запуска Redis-сервера
